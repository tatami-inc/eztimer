<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>eztimer: Easy timing of C++ functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">eztimer
   </div>
   <div id="projectbrief">Easy timing of C++ functions</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Easy timing of C++ functions </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/tatami-inc/eztimer/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/tatami-inc/eztimer/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/tatami-inc/eztimer"><img src="https://codecov.io/gh/tatami-inc/eztimer/branch/master/graph/badge.svg?token=7I3UBJLHSO" alt="codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>The <b>eztimer</b> library implements a simple timing framework for C++ functions, mostly intended for testing algorithms in other <a href="https://github.com/tatami-inc"><b>tatami</b></a> libraries. Users can supply multiple functions and <b>eztimer</b> will run them over multiple iterations in randomized order. The first "burn-in" iteration is also discarded to avoid any initialization effects. For convenience, we support both a per-function and overall cap on the runtime.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="eztimer_8hpp.html">eztimer/eztimer.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Setting up functions to be timed.</span></div>
<div class="line">std::vector&lt;std::function&lt;double()&gt; &gt; funs;</div>
<div class="line">funs.emplace_back([]() -&gt; <span class="keywordtype">double</span> {</div>
<div class="line">    <span class="keywordtype">double</span> blah = 0;</div>
<div class="line">    <span class="comment">// Do something that modifies &#39;blah&#39; as a side-effect.</span></div>
<div class="line">    <span class="keywordflow">return</span> blah;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">funs.emplace_back([]() -&gt; <span class="keywordtype">double</span> {</div>
<div class="line">    <span class="keywordtype">double</span> foo = 0;</div>
<div class="line">    <span class="comment">// Do something that modifies &#39;foo&#39; as a side-effect.</span></div>
<div class="line">    <span class="keywordflow">return</span> foo;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">funs.emplace_back([]() -&gt; <span class="keywordtype">double</span> {</div>
<div class="line">    <span class="keywordtype">double</span> bar = 0;</div>
<div class="line">    <span class="comment">// Do something that modifies &#39;bar&#39; as a side-effect.</span></div>
<div class="line">    <span class="keywordflow">return</span> bar;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structeztimer_1_1Options.html">eztimer::Options</a> opt;</div>
<div class="line">opt.<a class="code hl_variable" href="structeztimer_1_1Options.html#a5178899482fa713364c02daebfbec1fc">iterations</a> = 5;</div>
<div class="line">opt.<a class="code hl_variable" href="structeztimer_1_1Options.html#a57950559685cf449140e6bd819ee620b">max_time_per_function</a> = std::chrono::duration&lt;double&gt;(10); <span class="comment">// max 10 seconds per function.</span></div>
<div class="line">opt.<a class="code hl_variable" href="structeztimer_1_1Options.html#ad9567c0e8bc4eb080363d1cd0e68a59b">max_time_total</a> = std::chrono::duration&lt;double&gt;(60); <span class="comment">// max 60 seconds total runtime.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> output = <a class="code hl_function" href="namespaceeztimer.html#a371dee9730672f845910ce479347ec6e">eztimer::time&lt;double&gt;</a>(</div>
<div class="line">    funs, </div>
<div class="line">    <span class="comment">/* check = */</span> [](<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x, std::size_t i) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (x == 0) {</div>
<div class="line">            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;expected result of function &quot;</span> + std::to_string(i) + <span class="stringliteral">&quot; to be modified&quot;</span>); </div>
<div class="line">        }</div>
<div class="line">    },</div>
<div class="line">    opt</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">output[0].mean; <span class="comment">// mean runtime, in seconds.</span></div>
<div class="line">output[0].sd; <span class="comment">// standard deviation of the runtime across iterations.</span></div>
<div class="line">output[0].individual; <span class="comment">// times for the individual runs.</span></div>
<div class="ttc" id="aeztimer_8hpp_html"><div class="ttname"><a href="eztimer_8hpp.html">eztimer.hpp</a></div><div class="ttdoc">Easy timing of C++ functions.</div></div>
<div class="ttc" id="anamespaceeztimer_html_a371dee9730672f845910ce479347ec6e"><div class="ttname"><a href="namespaceeztimer.html#a371dee9730672f845910ce479347ec6e">eztimer::time</a></div><div class="ttdeci">std::vector&lt; Timings &gt; time(const std::vector&lt; std::function&lt; Result_()&gt; &gt; &amp;funs, const std::function&lt; void(const Result_ &amp;, std::size_t)&gt; &amp;check, const Options &amp;opt)</div><div class="ttdef"><b>Definition</b> eztimer.hpp:105</div></div>
<div class="ttc" id="astructeztimer_1_1Options_html"><div class="ttname"><a href="structeztimer_1_1Options.html">eztimer::Options</a></div><div class="ttdoc">Options for time().</div><div class="ttdef"><b>Definition</b> eztimer.hpp:27</div></div>
<div class="ttc" id="astructeztimer_1_1Options_html_a5178899482fa713364c02daebfbec1fc"><div class="ttname"><a href="structeztimer_1_1Options.html#a5178899482fa713364c02daebfbec1fc">eztimer::Options::iterations</a></div><div class="ttdeci">int iterations</div><div class="ttdef"><b>Definition</b> eztimer.hpp:32</div></div>
<div class="ttc" id="astructeztimer_1_1Options_html_a57950559685cf449140e6bd819ee620b"><div class="ttname"><a href="structeztimer_1_1Options.html#a57950559685cf449140e6bd819ee620b">eztimer::Options::max_time_per_function</a></div><div class="ttdeci">std::optional&lt; std::chrono::duration&lt; double &gt; &gt; max_time_per_function</div><div class="ttdef"><b>Definition</b> eztimer.hpp:53</div></div>
<div class="ttc" id="astructeztimer_1_1Options_html_ad9567c0e8bc4eb080363d1cd0e68a59b"><div class="ttname"><a href="structeztimer_1_1Options.html#ad9567c0e8bc4eb080363d1cd0e68a59b">eztimer::Options::max_time_total</a></div><div class="ttdeci">std::optional&lt; std::chrono::duration&lt; double &gt; &gt; max_time_total</div><div class="ttdef"><b>Definition</b> eztimer.hpp:63</div></div>
</div><!-- fragment --><p>Check out the <a href="https://tatami-inc.github.io/eztimer/">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Comments</h1>
<p>The <code>check</code> argument to <code><a class="el" href="namespaceeztimer.html#a371dee9730672f845910ce479347ec6e">eztimer::time()</a></code> ensures that the result of each function call has a user-visible effect on the program. This prevents the compiler from optimizing away the function call entirely. In the example above, we threw an error if the result of each call did not follow our non-zero expectation. We could also be more concrete if we expected all functions to return the same result:</p>
<div class="fragment"><div class="line">std::optional&lt;double&gt; expected;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> check = [&amp;](<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x, std::size_t i) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (expected.has_value()) {</div>
<div class="line">        <span class="keywordflow">if</span> (*expected != x) {</div>
<div class="line">            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;unexpected result from function &quot;</span> + std::to_string(i)); </div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        expected = x;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Another option is to simply print the result to standard output. This may also be generally useful to track the progress of <code>time()</code> for long-running functions.</p>
<div class="fragment"><div class="line">std::vector&lt;std::string&gt; names { <span class="stringliteral">&quot;blah&quot;</span>, <span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;bar&quot;</span> };</div>
<div class="line"><span class="keyword">auto</span> check = [&amp;](<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x, std::size_t i) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Function &#39;&quot;</span> &lt;&lt; names[i] &lt; <span class="stringliteral">&quot;&#39; returning &quot;</span> &lt;&lt; x &lt;&lt; std::endl;</div>
<div class="line">};</div>
</div><!-- fragment --><p>As for the timing itself, we just measure the wall time taken to execute each function. We don't bother with the <code>sys</code>/<code>user</code> distinction, or try to measure cycles, or anything particularly complicated. It seems pointless to try to be too smart here as execution time depends on so many factors - if you want generalizable conclusions about performance, the best approach is to repeat the timings on different machines.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  eztimer</div>
<div class="line">  GIT_REPOSITORY https://github.com/tatami-inc/eztimer</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(eztimer)</div>
</div><!-- fragment --><p>Then you can link to <b>tatami</b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe eztimer)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE eztimer)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
CMake using <code>find_package()</code></h2>
<p>You can install the library by cloning a suitable version of this repository and running the following commands:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DEZTIMER_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>Then you can use <code>find_package()</code> as usual:</p>
<div class="fragment"><div class="line">find_package(tatami_eztimer CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE tatami::eztimer)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files the <code>include/</code> subdirectory - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. This also requires the external dependencies listed in <a href="extern/CMakeLists.txt"><code>extern/CMakeLists.txt</code></a> as well as Zlib. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
